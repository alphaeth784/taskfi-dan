# 🚀 TaskFi Deployment Guide\n\nThis guide covers deploying TaskFi to production environments.\n\n## 📋 Pre-deployment Checklist\n\n### Environment Setup\n- [ ] PostgreSQL database configured (Supabase recommended)\n- [ ] Environment variables configured\n- [ ] Solana RPC endpoint secured\n- [ ] Smart contracts deployed to mainnet\n- [ ] Domain name configured (optional)\n\n### Database Setup\n- [ ] Production database created\n- [ ] Prisma schema pushed\n- [ ] Database seeded with initial data\n- [ ] Database backups configured\n\n### Security\n- [ ] NextAuth secret generated\n- [ ] Environment variables secured\n- [ ] CORS policies configured\n- [ ] Rate limiting implemented\n\n## 🌐 Vercel Deployment (Recommended)\n\n### Step 1: Prepare Repository\n\n1. **Ensure all code is committed**\n   ```bash\n   git add .\n   git commit -m \"Ready for deployment\"\n   git push origin main\n   ```\n\n2. **Verify build locally**\n   ```bash\n   bun run build\n   ```\n\n### Step 2: Deploy to Vercel\n\n1. **Install Vercel CLI** (optional)\n   ```bash\n   npm i -g vercel\n   ```\n\n2. **Connect to Vercel**\n   - Visit [vercel.com](https://vercel.com)\n   - Click \"Import Project\"\n   - Connect your GitHub repository\n   - Select the TaskFi repository\n\n3. **Configure Build Settings**\n   - Framework Preset: Next.js\n   - Build Command: `bun run build`\n   - Output Directory: `.next`\n   - Install Command: `bun install`\n\n### Step 3: Environment Variables\n\nAdd the following environment variables in Vercel dashboard:\n\n```bash\n# Database\nDATABASE_URL=\"postgresql://...\"\n\n# Supabase\nNEXT_PUBLIC_SUPABASE_URL=\"https://xxx.supabase.co\"\nNEXT_PUBLIC_SUPABASE_ANON_KEY=\"eyJ...\"\nSUPABASE_SERVICE_ROLE_KEY=\"eyJ...\"\nSUPABASE_JWT_SECRET=\"xxx\"\n\n# Authentication\nNEXTAUTH_SECRET=\"xxx\" # Generate with: openssl rand -base64 32\nNEXTAUTH_URL=\"https://your-domain.vercel.app\"\n\n# Solana\nNEXT_PUBLIC_SOLANA_NETWORK=\"mainnet-beta\"\nNEXT_PUBLIC_SOLANA_RPC_URL=\"https://api.mainnet-beta.solana.com\"\n\n# Real-time (Optional)\nPUSHER_APP_ID=\"xxx\"\nPUSHER_KEY=\"xxx\"\nPUSHER_SECRET=\"xxx\"\nPUSHER_CLUSTER=\"xxx\"\nNEXT_PUBLIC_PUSHER_KEY=\"xxx\"\nNEXT_PUBLIC_PUSHER_CLUSTER=\"xxx\"\n\n# Deployment\nNODE_ENV=\"production\"\n```\n\n### Step 4: Deploy\n\n1. **Trigger Deployment**\n   - Vercel automatically deploys on git push\n   - Or click \"Deploy\" in Vercel dashboard\n\n2. **Monitor Build**\n   - Watch build logs in Vercel dashboard\n   - Fix any build errors\n\n3. **Verify Deployment**\n   - Test wallet connection\n   - Test user registration\n   - Test database connectivity\n\n## 🐳 Docker Deployment\n\n### Dockerfile\n\n```dockerfile\nFROM oven/bun:latest AS base\nWORKDIR /app\n\n# Install dependencies\nCOPY package.json bun.lockb ./\nRUN bun install --frozen-lockfile\n\n# Copy source code\nCOPY . .\n\n# Generate Prisma client\nRUN bunx prisma generate\n\n# Build application\nRUN bun run build\n\n# Production stage\nFROM oven/bun:latest AS production\nWORKDIR /app\n\n# Copy built application\nCOPY --from=base /app/.next ./.next\nCOPY --from=base /app/public ./public\nCOPY --from=base /app/package.json ./package.json\nCOPY --from=base /app/node_modules ./node_modules\nCOPY --from=base /app/prisma ./prisma\n\nEXPOSE 3000\nCMD [\"bun\", \"run\", \"start\"]\n```\n\n### Docker Compose\n\n```yaml\nversion: '3.8'\nservices:\n  taskfi:\n    build: .\n    ports:\n      - \"3000:3000\"\n    environment:\n      - NODE_ENV=production\n      - DATABASE_URL=${DATABASE_URL}\n      - NEXTAUTH_SECRET=${NEXTAUTH_SECRET}\n      - NEXTAUTH_URL=${NEXTAUTH_URL}\n    depends_on:\n      - postgres\n      \n  postgres:\n    image: postgres:15\n    environment:\n      - POSTGRES_DB=taskfi\n      - POSTGRES_USER=taskfi\n      - POSTGRES_PASSWORD=${DB_PASSWORD}\n    volumes:\n      - postgres_data:/var/lib/postgresql/data\n    ports:\n      - \"5432:5432\"\n      \nvolumes:\n  postgres_data:\n```\n\n## ☁️ Cloud Deployment\n\n### AWS Amplify\n\n1. **Create Amplify App**\n   ```bash\n   aws amplify create-app --name taskfi\n   ```\n\n2. **Configure Build Settings**\n   ```yaml\n   version: 1\n   frontend:\n     phases:\n       preBuild:\n         commands:\n           - npm install -g bun\n           - bun install\n       build:\n         commands:\n           - bun run build\n     artifacts:\n       baseDirectory: .next\n       files:\n         - '**/*'\n   ```\n\n### Railway\n\n1. **Connect Repository**\n   - Visit [railway.app](https://railway.app)\n   - Connect GitHub repository\n   \n2. **Configure Environment**\n   - Add environment variables\n   - Railway auto-detects Next.js\n\n3. **Deploy**\n   - Railway automatically builds and deploys\n\n## 🔧 Smart Contract Deployment\n\n### Prerequisites\n\n1. **Install Solana CLI**\n   ```bash\n   sh -c \"$(curl -sSfL https://release.solana.com/v1.17.0/install)\"\n   ```\n\n2. **Install Anchor CLI**\n   ```bash\n   npm install -g @coral-xyz/anchor-cli\n   ```\n\n3. **Create Wallet**\n   ```bash\n   solana-keygen new --outfile ~/.config/solana/id.json\n   ```\n\n4. **Fund Wallet** (mainnet)\n   - Transfer SOL to your wallet address\n   - Minimum 5 SOL recommended for deployment\n\n### Deploy Escrow Program\n\n1. **Build Program**\n   ```bash\n   cd programs\n   anchor build\n   ```\n\n2. **Deploy to Mainnet**\n   ```bash\n   solana config set --url mainnet-beta\n   anchor deploy --program-id EscrowTaskFi1111111111111111111111111111111\n   ```\n\n3. **Update Frontend**\n   - Update `ESCROW_PROGRAM_ID` in `src/lib/escrow.ts`\n   - Update `PLATFORM_ADMIN_KEY` with your admin wallet\n\n4. **Verify Deployment**\n   ```bash\n   solana program show EscrowTaskFi1111111111111111111111111111111\n   ```\n\n### Initialize Program\n\n1. **Create Admin Account**\n   ```bash\n   # Use your admin wallet to initialize\n   anchor run initialize-admin\n   ```\n\n2. **Set Platform Fees**\n   ```bash\n   # Configure platform fee percentage\n   anchor run set-platform-fee\n   ```\n\n## 🗄️ Database Migration\n\n### Production Migration\n\n1. **Backup Existing Database**\n   ```bash\n   pg_dump $DATABASE_URL > backup.sql\n   ```\n\n2. **Run Migrations**\n   ```bash\n   bunx prisma migrate deploy\n   ```\n\n3. **Seed Production Data**\n   ```bash\n   NODE_ENV=production bunx tsx prisma/seed.ts\n   ```\n\n### Database Maintenance\n\n1. **Regular Backups**\n   ```bash\n   # Daily backup script\n   pg_dump $DATABASE_URL | gzip > \"backup-$(date +%Y%m%d).sql.gz\"\n   ```\n\n2. **Monitor Performance**\n   - Use Supabase dashboard\n   - Monitor slow queries\n   - Set up alerts\n\n## 📊 Monitoring & Analytics\n\n### Application Monitoring\n\n1. **Vercel Analytics**\n   - Enable in Vercel dashboard\n   - Monitor page views and performance\n\n2. **Error Tracking**\n   ```bash\n   npm install @sentry/nextjs\n   ```\n   \n   Configure Sentry in `next.config.js`:\n   ```javascript\n   const { withSentryConfig } = require('@sentry/nextjs')\n   \n   module.exports = withSentryConfig({\n     // Your Next.js config\n   })\n   ```\n\n3. **Uptime Monitoring**\n   - Set up monitors for critical endpoints\n   - `/api/health`\n   - `/api/users`\n   - `/api/jobs`\n\n### Database Monitoring\n\n1. **Supabase Dashboard**\n   - Monitor active connections\n   - Query performance\n   - Storage usage\n\n2. **Custom Alerts**\n   ```javascript\n   // Add to API routes\n   const startTime = Date.now()\n   // ... your logic\n   const duration = Date.now() - startTime\n   if (duration > 1000) {\n     console.warn(`Slow query: ${duration}ms`)\n   }\n   ```\n\n## 🚨 Troubleshooting\n\n### Common Issues\n\n1. **Build Failures**\n   ```bash\n   # Clear Next.js cache\n   rm -rf .next\n   \n   # Reinstall dependencies\n   rm -rf node_modules\n   bun install\n   \n   # Regenerate Prisma client\n   bunx prisma generate\n   ```\n\n2. **Database Connection Issues**\n   ```bash\n   # Test connection\n   bunx prisma db pull\n   \n   # Reset database (dev only)\n   bunx prisma migrate reset\n   ```\n\n3. **Wallet Connection Issues**\n   - Check RPC endpoint status\n   - Verify network configuration\n   - Test with different wallet providers\n\n4. **Smart Contract Issues**\n   ```bash\n   # Check program logs\n   solana logs EscrowTaskFi1111111111111111111111111111111\n   \n   # Verify program deployment\n   solana program show EscrowTaskFi1111111111111111111111111111111\n   ```\n\n### Performance Optimization\n\n1. **Next.js Optimization**\n   ```javascript\n   // next.config.js\n   module.exports = {\n     experimental: {\n       turbo: true,\n     },\n     images: {\n       domains: ['supabase.co'],\n     },\n     compress: true,\n   }\n   ```\n\n2. **Database Optimization**\n   ```sql\n   -- Add indexes for common queries\n   CREATE INDEX idx_jobs_status ON jobs(status);\n   CREATE INDEX idx_jobs_category ON jobs(category_id);\n   CREATE INDEX idx_users_role ON users(role);\n   ```\n\n## 📞 Support\n\nIf you encounter issues during deployment:\n\n1. Check the troubleshooting section above\n2. Review Vercel build logs\n3. Monitor application logs\n4. Contact support at support@taskfi.io\n\n## 🔄 CI/CD Pipeline\n\n### GitHub Actions\n\n```yaml\nname: Deploy to Production\n\non:\n  push:\n    branches: [main]\n\njobs:\n  deploy:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v3\n      \n      - name: Setup Bun\n        uses: oven-sh/setup-bun@v1\n        \n      - name: Install dependencies\n        run: bun install\n        \n      - name: Run tests\n        run: bun test\n        \n      - name: Build application\n        run: bun run build\n        \n      - name: Deploy to Vercel\n        uses: amondnet/vercel-action@v20\n        with:\n          vercel-token: ${{ secrets.VERCEL_TOKEN }}\n          vercel-org-id: ${{ secrets.ORG_ID }}\n          vercel-project-id: ${{ secrets.PROJECT_ID }}\n          vercel-args: '--prod'\n```\n\n---\n\n**Ready to launch TaskFi! 🚀**"